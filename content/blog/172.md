---
title:      Dump des threads Python
date:       2018-05-03
author:     Michel Casabianca
email:      michel.casabianca@gmail.com
id:         172
categories: []
tags:       [python]
lang:       fr
toc:        false
new:        true
---

En cas de problème dans une application Python (boucle infinie ou autre), il peut être utile d'afficher un dump de tous les threads.

<!--more-->

Pour ce faire :

- Définir la variable d'environnement *PYTHONFAULTHANDLER* avec la commande `export PYTHONFAULTHANDLER=true`. Cela demande à la VM Python d'afficher un dump des threads lorsqu'elle reçoit un signal Unix.
- Lancer l'application Python dans un terminal (de manière à voir le dump des threads). On récupérera le process ID de la VM avec `ps ax | grep python`.
- Envoyer le signal à l'application avec la commande `kill -SIGABRT <pid>`. La VM Python affiche alors les traces des threads en cours.

```
Fatal Python error: Aborted

Thread 0x00007f018061e700 (most recent call first):
  File "/opt/python/3.5.4/lib/python3.5/selectors.py", line 376 in select
  File "/opt/python/3.5.4/lib/python3.5/socketserver.py", line 232 in serve_forever
  File "/home/casa/doc/.../venv/lib/python3.5/site-packages/django/core/servers/basehttp.py", line 174 in run
  File "/home/casa/doc/.../venv/lib/python3.5/site-packages/django/core/management/commands/runserver.py", line 148 in inner_run
  File "/home/casa/doc/.../venv/lib/python3.5/site-packages/django/utils/autoreload.py", line 228 in wrapper

...
```

*Enjoy!*
